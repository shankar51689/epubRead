<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>EPUB Reader</title>

<script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  background: #f5f5f5;
  font-family: sans-serif;
}

#toolbar {
  height: 48px;
  background: #222;
  color: white;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 8px;
}

#toolbar button {
  background: #444;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 4px;
}

#viewer {
  height: calc(100% - 48px);
  width: 100%;
}

.dark {
  background: #121212 !important;
}
</style>
</head>

<body>

<div id="toolbar">
  <button onclick="prev()">â—€</button>
  <button onclick="next()">â–¶</button>
  <button onclick="toggleTheme()">ðŸŒ“</button>
  <button onclick="fontSize(-10)">Aâˆ’</button>
  <button onclick="fontSize(10)">A+</button>
</div>

<div id="viewer"></div>

<script>
function getParam(name) {
  return new URLSearchParams(window.location.search).get(name);
}

const epubUrl = getParam("url");
if (!epubUrl) alert("EPUB URL missing");

let book = ePub(epubUrl);
let rendition = book.renderTo("viewer", {
  width: "100%",
  height: "100%",
  flow: "paginated",
  spread: "always"
});

let fontScale = 100;
let isDark = false;

rendition.display();

/* THEME */
rendition.themes.register("dark", {
  body: {
    background: "#121212",
    color: "#eaeaea"
  }
});

rendition.themes.register("light", {
  body: {
    background: "#ffffff",
    color: "#000000"
  }
});

/* CONTROLS */
function next() {
  rendition.next();
}

function prev() {
  rendition.prev();
}

function fontSize(delta) {
  fontScale += delta;
  rendition.themes.fontSize(fontScale + "%");
}

function toggleTheme() {
  isDark = !isDark;
  rendition.themes.select(isDark ? "dark" : "light");
}

/* RN COMMUNICATION */
rendition.on("relocated", location => {
  if (window.ReactNativeWebView) {
    window.ReactNativeWebView.postMessage(
      JSON.stringify({
        type: "pageChange",
        cfi: location.start.cfi
      })
    );
  }
});
</script>

</body>
</html>
